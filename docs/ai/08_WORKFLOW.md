# 8. 開発ワークフローガイド

このドキュメントでは、`ecsite-v2` プロジェクトにおける標準的な開発ワークフローについて説明します。一貫したプロセスに従うことで、コードの品質を維持し、チームでの共同作業を円滑に進めることができます。

## Git Flow

当プロジェクトでは、Git Flowに基づいたブランチ戦略を採用しています。

### 主要ブランチ

*   **`main`:**
    *   常にリリース可能な安定した状態を保つブランチ。
    *   直接コミットすることは禁止されています。
    *   `release` ブランチまたは `hotfix` ブランチからのみマージされます。
*   **`develop`:**
    *   次のリリースに向けた開発の統合ブランチ。
    *   比較的安定していますが、`main` ほどではありません。
    *   `feature` ブランチからマージされます。
    *   `release` ブランチは `develop` から分岐します。

### サポートブランチ

*   **`feature/<feature-name>`:**
    *   新しい機能の開発を行うためのブランチ。
    *   `develop` ブランチから分岐します。
    *   機能開発が完了したら、`develop` ブランチに対してPull Requestを作成します。
    *   命名規則: `feature/issue-<issue番号>-short-description` (例: `feature/issue-123-add-user-profile`)
*   **`release/<release-version>`:**
    *   リリースの準備を行うためのブランチ（リリース前の最終調整、バグ修正、ドキュメント更新など）。
    *   `develop` ブランチから分岐します。
    *   リリース準備が完了したら、`main` ブランチと `develop` ブランチの両方にマージされます。
    *   命名規則: `release/v1.2.0`
*   **`hotfix/<hotfix-name>`:**
    *   リリース済みの `main` ブランチに対する緊急のバグ修正を行うためのブランチ。
    *   `main` ブランチから分岐します。
    *   修正が完了したら、`main` ブランチと `develop` ブランチの両方にマージされます。
    *   命名規則: `hotfix/fix-critical-login-bug`

### 基本的な開発フロー (新機能開発)

1.  **`develop` ブランチを最新化:**
    ```bash
    git checkout develop
    git pull origin develop
    ```
2.  **`feature` ブランチを作成:**
    ```bash
    git checkout -b feature/issue-XXX-your-feature-name develop
    ```
3.  **コーディングとコミット:**
    *   機能開発を進め、適切な粒度でコミットします。コミットメッセージは後述の規約に従ってください。
    *   ```bash
        git add .
        git commit -m "feat: Add user profile page"
        ```
4.  **`feature` ブランチをリモートにプッシュ:**
    ```bash
    git push origin feature/issue-XXX-your-feature-name
    ```
5.  **Pull Request (PR) の作成:**
    *   GitHubなどのリポジトリホスティングサービス上で、`feature/issue-XXX` から `develop` へのPull Requestを作成します。
    *   PRのテンプレートに従い、変更内容、理由、テスト内容などを記述します。
6.  **コードレビュー:**
    *   レビュワーを指名し、レビューを依頼します。
    *   レビューでの指摘事項に対応し、必要に応じて追加コミットを行います。
7.  **PRのマージ:**
    *   レビューで承認されたら、PRを `develop` ブランチにマージします。（通常はリポジトリホスティングサービスの機能を使用）
8.  **ローカルブランチの削除 (任意):**
    ```bash
    git checkout develop
    git branch -d feature/issue-XXX-your-feature-name
    ```

## コミットメッセージ規約

当プロジェクトでは [Conventional Commits](https://www.conventionalcommits.org/) に準拠したコミットメッセージを推奨します。

**フォーマット:**

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

*   **`<type>`:** コミットの種類を示す (必須)。
    *   `feat`: 新機能の追加
    *   `fix`: バグ修正
    *   `docs`: ドキュメントのみの変更
    *   `style`: コードスタイルに関する変更 (フォーマット、セミコロンなど)
    *   `refactor`: リファクタリング (機能変更やバグ修正を含まないコード変更)
    *   `perf`: パフォーマンス改善
    *   `test`: テストコードの追加・修正
    *   `build`: ビルドシステムや外部依存関係に関する変更 (Gradle, npmなど)
    *   `ci`: CI設定やスクリプトに関する変更
    *   `chore`: 上記いずれにも当てはまらない雑多な変更 (依存関係更新など)
*   **`[optional scope]`:** コミットが影響する範囲を示す (任意)。例: `account`, `api`, `db`
*   **`<description>`:** 変更内容の簡潔な説明 (必須)。現在形・命令形で記述し、大文字で始めない。ピリオドで終えない。
*   **`[optional body]`:** 変更の詳細な説明 (任意)。変更の理由や背景、以前の動作との違いなどを記述。
*   **`[optional footer(s)]`:** 関連するIssue番号などを記述 (任意)。例: `Fixes #123`, `Refs #456`

**良い例:**

```
feat(auth): add password reset functionality

Implement the password reset flow using email verification.
Users can now request a password reset link via their registered email.

Fixes #123
```

**悪い例:**

```
fix bug
```
```
updated stuff
```

## Pull Request (PR)

*   **目的:** コード変更を `develop` や `main` ブランチにマージする前に、レビューと議論を行うための仕組みです。
*   **作成:** GitHubなどのプラットフォームで、`feature` ブランチから `develop` へ、または `release`/`hotfix` ブランチから `main`/`develop` へのPRを作成します。
*   **テンプレート:** PR作成時には、用意されたテンプレートに従って以下の情報を記述してください。
    *   **変更の概要:** 何を変更したのか簡潔に。
    *   **変更の理由:** なぜこの変更が必要なのか。背景や目的。
    *   **関連Issue:** 関連するIssueがあればリンク (`Fixes #XXX`, `Refs #XXX`)。
    *   **変更内容の詳細:** 具体的な変更点、技術的な判断など。
    *   **テスト内容:** どのようにテストしたか（単体テスト、結合テスト、手動確認など）。
    *   **レビュー依頼事項:** 特に見てほしい点、懸念点など。
    *   **スクリーンショット/動画:** UI変更がある場合は添付。
*   **WIP (Work In Progress):** 開発途中のコードについて意見が欲しい場合は、タイトルに `[WIP]` を付けてPRを作成し、早期にフィードバックを求めることができます。マージ準備が整うまで、マージ不可の状態にしておきます。

## コードレビュー

*   **目的:** コードの品質向上、知識共有、バグの早期発見。
*   **依頼:** PR作成後、適切なレビュワー（通常はチームメンバー）を指名してレビューを依頼します。
*   **レビュワーの観点:**
    *   **設計:** 要件を満たしているか、拡張性・保守性は考慮されているか。
    *   **ロジック:** 正しく動作するか、エッジケースは考慮されているか。
    *   **可読性:** コードは理解しやすいか、命名は適切か。
    *   **テスト:** 十分なテストが書かれているか、テストは適切か。
    *   **規約:** コーディング規約に従っているか。
    *   **パフォーマンス:** 非効率な処理はないか。
    *   **セキュリティ:** 脆弱性はないか。
*   **コメント:**
    *   具体的かつ建設的なコメントを心がけます。問題点を指摘するだけでなく、改善案も提示できると良いでしょう。
    *   敬意を持ってコミュニケーションをとります。
    *   LGTM (Looks Good To Me) だけではなく、なぜ良いと思ったのか具体的に記述することも推奨されます。
*   **対応:**
    *   レビュワーからのコメントに感謝し、指摘事項に対応します。
    *   修正が必要な場合は追加コミットを行い、PRにプッシュします。
    *   コメントに対して質問や反論がある場合は、PR上で丁寧に議論します。
*   **承認とマージ:**
    *   レビュワーから承認 (Approve) を得られたら、PRをマージします。マージは通常、PR作成者が行いますが、プロジェクトのルールに従ってください。

## CI/CD (継続的インテグレーション/継続的デリバリー)

*   **概要:** (もしCI/CDパイプラインが設定されている場合) PR作成時や `develop`/`main` ブランチへのマージ時に、自動的にビルド、テスト、静的解析などが実行されます。
*   **設定:** CI/CDの設定ファイル（例: `.github/workflows/ci.yml`）で定義されています。
*   **確認:** CIの実行結果（成功/失敗）をPR上で確認し、失敗した場合は原因を調査して修正します。
*   **デプロイ:** (もしCDが設定されている場合) 特定のブランチ（例: `main`）へのマージをトリガーに、ステージング環境や本番環境への自動デプロイが行われる場合があります。

このワークフローに従うことで、スムーズで高品質な開発を進めることができます。不明な点があれば、チームメンバーに確認してください。
